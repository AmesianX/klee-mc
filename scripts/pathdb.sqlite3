CREATE TABLE path(
	pathid	INTEGER PRIMARY KEY,
	phash	VARCHAR(40),
	ktesthash VARCHAR(40))
;

CREATE TABLE sb(
	sbaddr	INT8 PRIMARY KEY,
	sblen	INT2,
	name	VARCHAR(32))
;

CREATE TABLE pathnode(
	nid		INTEGER PRIMARY KEY,
	pathid		INTEGER,
	minpos		INTEGER,
	sbaddr		INT8,
	FOREIGN KEY(pathid) REFERENCES path(pathid),
	FOREIGN KEY(sbaddr) REFERENCES sb(sbaddr))
;

CREATE INDEX pn_sbaddr_idx on pathnode (sbaddr)
;

CREATE TABLE totalpathnode(
	pnid		INTEGER PRIMARY KEY,
	pathid		INTEGER,
	pos		INTEGER,
	sbaddr		INT8,
	FOREIGN KEY(pathid) REFERENCES path(pathid),
	FOREIGN KEY(sbaddr) REFERENCES sb(sbaddr))
;

CREATE VIEW minpaths AS
	SELECT pathid,MIN(minpos) as minpos, name
	FROM sb
	INNER JOIN pathnode
	ON sb.sbaddr=pathnode.sbaddr
	GROUP BY sb.sbaddr
	ORDER BY minpos
;

CREATE INDEX minpos_idx on pathnode (minpos)
;